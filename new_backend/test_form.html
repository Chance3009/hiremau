<!DOCTYPE html>
<html>

<head>
    <title>Test Candidate Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }

        form {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
        }

        input,
        select {
            width: 100%;
            padding: 8px;
            margin: 5px 0 15px 0;
            box-sizing: border-box;
        }

        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #0056b3;
        }

        .result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>

<body>
    <h1>Test Candidate Registration</h1>

    <form id="candidateForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" value="Test User" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="test@example.com" required>

        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone" value="+1-555-0123" required>

        <label for="event_id">Event:</label>
        <select id="event_id" name="event_id" required>
            <option value="">Select Event</option>
        </select>

        <label for="job_id">Position:</label>
        <select id="job_id" name="job_id" required>
            <option value="">Select Position</option>
        </select>

        <label for="resume">Resume (optional):</label>
        <input type="file" id="resume" name="resume" accept=".pdf,.doc,.docx">

        <button type="submit">Register Candidate</button>
    </form>

    <div id="result"></div>

    <script>
        const API_BASE = 'http://localhost:8001';

        // Load events and jobs on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Load events
                const eventsResponse = await fetch(`${API_BASE}/events/active/list`);
                const events = await eventsResponse.json();
                const eventSelect = document.getElementById('event_id');
                events.forEach(event => {
                    const option = document.createElement('option');
                    option.value = event.id;
                    option.textContent = event.title;
                    eventSelect.appendChild(option);
                });

                // Load jobs
                const jobsResponse = await fetch(`${API_BASE}/jobs/active/list`);
                const jobs = await jobsResponse.json();
                const jobSelect = document.getElementById('job_id');
                jobs.forEach(job => {
                    const option = document.createElement('option');
                    option.value = job.id;
                    option.textContent = job.title;
                    jobSelect.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading data:', error);
                showResult('Error loading events and jobs: ' + error.message, 'error');
            }
        });

        // Handle form submission
        document.getElementById('candidateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();

            // Prepare candidate data
            const candidateData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                event_id: document.getElementById('event_id').value,
                job_id: document.getElementById('job_id').value,
                stage: 'applied',
                status: 'active',
                source: 'test_form'
            };

            formData.append('candidate_data', JSON.stringify(candidateData));

            // Add resume file if selected
            const resumeFile = document.getElementById('resume').files[0];
            if (resumeFile) {
                formData.append('resume_file', resumeFile);
            }

            try {
                const response = await fetch(`${API_BASE}/candidates/quick-register`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    showResult(`Success! Candidate created with ID: ${result.candidate_id || result.id}`, 'success');
                    document.getElementById('candidateForm').reset();
                } else {
                    const error = await response.json();
                    showResult(`Error: ${error.detail || 'Failed to create candidate'}`, 'error');
                }
            } catch (error) {
                showResult(`Network error: ${error.message}`, 'error');
            }
        });

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
    </script>
</body>

</html>